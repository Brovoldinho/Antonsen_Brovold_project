---
title: "Does changes in the price of salmon affect salmon producing companies? "
author: "Even Grindstad Brovold & Orjan Mikal Antonsen"
date: "16 november 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(httr)
library(rjstat)
library(jsonlite)
library(PxWebApiData)
library(tidyr)
library(readr)
library(dplyr)
library(ggvis)
library(lubridate)
library(mosaic) 
```

####**Introduction**
The norwegian salmon has become a highly demanded commodity, during the past couple of decades. This had made salmon production a big buisiness in Norway. In fact the fifth most valuable company listed on the norwegian stock marked, is a salmon producing company, respectively "Marine harvest". The second largest salmon producing company in Norway is "Salmar", who holds the tenth place on the list of most valuable stocks. Considering a rich country like Norway, the position of these two companies means they are doing serious buisiness. 

In this analysis we are going to take a look at how the stock prices of these two have changed the past years. We will also take a look at how the price of salmon has changed during the course of the last years. Then we will take a look on how the changes in the price of salmon, has affected the stock value of the aforementioned salmon producing companies. We will be using data from the statistical bureau in Norway "SSB", and from https://www.netfonds.no/ who provides stock data. As addidtional information, we will be focusing on raw salmon and not frozen. This is simply due to the fact that there is fourthy times more turnover of raw salmon than frozen.


####The salmon price during the last years

```{r}
laksepris <- ApiData("http://data.ssb.no/api/v0/dataset/1122.json?lang=no", 
                     getDataByGET = TRUE, col_types = cols(måned = col_date(format = "%Y%m")))

# Henter ut datasettet fra laksepris
laksepris <- laksepris[[1]]


# Long til wide
laksepris <- spread(laksepris, statistikkvariabel, value)

colnames(laksepris) <- c("Goods", "Date", "Price_per_kg_NOK", "Volume_tons")

laksepris <- laksepris %>% 
  filter(Goods == "Fersk oppalen laks")

#Fikser datoen
today <- Sys.Date()

newdate <- seq(as.Date("2000-01-01"), as.Date(today), by = "weeks")

# Oppdateringen fra SSB henger en uke etter slik at vi må fjerne den siste uken fra,
# newdate før vi klistrer den inn i datokolonnen i laksepris.

newdate <- head(newdate, -1)

laksepris$Date <- newdate

# I tilfeller hvor dato matcher med laksepris datoene, betyr det at oppdatering
# fra SSB i nåværende øyeblikk ikke henger en uke etter, slik at da ser man bort ifra
# de to siste linjenene, og kjører rm(list=ls()) som står øverst i r fila.
# Deretter kjører man laksepris$Datw <- newdate alene, for å få riktig dato.


#Datoene strekker seg ikke like langt tilbake i tid,
# som salmar_marine så tar med relevante datoer.

laksepris <- filter(laksepris, Date > "2007-05-04")
fixeddate <- seq(as.Date("2007-05-07"), as.Date(today), by = "weeks")

fixeddate <- head(fixeddate, -1)

laksepris$Date <- fixeddate

rm(newdate)

laksepris %>% ggvis(~Date, ~Price_per_kg_NOK) %>%
  layer_paths() %>%
  add_axis("y", title = "Price per kg in NOK") %>%
  layer_smooths(stroke := "red")

siste_laksepris <-tail(laksepris$Price_per_kg_NOK, 1)

```

We will start this analysis by diving into the development of the salmon price during the past years. As we can see from the graph above, the price has almost tripled since 2007 to 2018. Then later the prize has taken a litle hit at start of the summer of 2018. There has been massive fluctuations in the price, especially in the years 2011-2012, 2014-2015 and 2017-2018. The reason behind these fluctuations is not what this analysis will focus on, so this is merely an observation. The most important lesson from this graph is the red line showing a continuosly growth in the salmon price in the past years. The last uppdated salmon price as this repport is written is `r siste_laksepris` NOK/kg.


####Salmar and Marine harvest during the course of past years

```{r, message=FALSE }
#Leser inn data fra netfonds på Salmar
salmar <- read_csv("https://www.netfonds.no/quotes/paperhistory.php?paper=SALM.OSE&csv_format=csv")

#Leser inn data fra netfonds på Marine harvest
marine_harvest <- read_csv("https://www.netfonds.no/quotes/paperhistory.php?paper=MHG.OSE&csv_format=csv")


# Velger open price og dato fra salmar dataframe
salmar <- salmar %>% select(quote_date, open)

#Velger open price og dato fra marine_harvest dataframe
marine_harvest <- marine_harvest %>% select(quote_date, open)

# Fikser på kolonnenavn i salmar og marine_harvest
colnames(salmar) <- c("Date", "Salmar")
colnames(marine_harvest) <- c("Date", "Marine harvest") 

# Merger marine_harvest og salmar
marine_salmar <- left_join(salmar, marine_harvest, by = "Date")

# Går fra wide til long i marine_salmar filen
marine_salmar<- marine_salmar %>% gather(key = "Firm", value = "Stock_value", -Date)

#Plotter og fikser datoformatet for marine_salmar


marine_salmar$Date <- ymd(marine_salmar$Date)

marine_salmar %>% 
  group_by(Firm) %>%
  ggvis(~Date, ~Stock_value, stroke = ~Firm) %>%
  layer_paths() %>%
  add_axis("y", title = "Stock value")
```

Keep in mind that this graph displays the price of a stock share per company. It does not display the value of the the company itself. As earlier mentioned Marine harvest was listed as more valuable than Salmar. A short glimpse at this graph might imply that Salmar is more valuable than Marine harvest, but that is not the case. However this graph shows us that these two companies often tend to experience the same fluctuations. Take a look at the year 2011. Both companies faces a decrease in stock value during that year. From 2012 to 2014 they almost have the same growth in stock value. 

Looking throughout this entire graph it seems like whenever one of the companies has a posetive growth in the stock share value, the other company experiences the same. Likewise when one of them is experiencing a decrease in stock value, the same happens to the other company. Of course these changes is different in these two companies. Especially after the year of 2016, where it seems like Salmar is experiencing a greater increase in stock share value, than Marine harvest does. Although the magnitude of the fluctuations vary a lot between these firms after 2016, they have the same tendensies when the counterpart experiences decrease or increase in stock share values.

#### Including the salmon price in the graph with Salmar and Marine harvest

```{r}
marine_salmar <- marine_salmar %>%
group_by(Date = cut(Date, "week"), Firm) %>% 
  summarise(value = mean(Stock_value))

marine_salmar$Date <- ymd(marine_salmar$Date)

# Merger marine_salmar og laksepris

marine_salmar_laksepris <- left_join(laksepris, marine_salmar, by = "Date")

# Plotter kurs for salmar og marine, og legger inn kilosprisen.

marine_salmar_laksepris%>% 
  group_by(Firm) %>%
  ggvis(~Date, ~value, stroke = ~Firm)%>%
  layer_paths()%>%
  layer_paths(~Date, ~Price_per_kg_NOK, stroke = "Price per kg in NOK")%>%
  add_axis("y", title = "Value")
```

With the including of the salmon price in this graph we can se that there are some tendencies of correlation between the salmon price and the stock share price for our aformentioned companies. Maybe a bit hard to tell in this graph, but we can take a look at a figure from 2014 to today instead.

```{r}
marine_salmar_laksepris%>% 
  group_by(Firm) %>%
  filter(Date>"2014-01-01") %>%
  ggvis(~Date, ~value, stroke = ~Firm)%>%
  layer_paths()%>%
  layer_paths(~Date, ~Price_per_kg_NOK, stroke = "Price per kg in NOK")%>%
  add_axis("y", title = "Value")
```

In this graph it's a bit easier to spot some tendencies. Especially mid 2016, and the first quarter of 2017. Where we ca see a decrease in the salmon price we also se a decrease in stock share price for our companies. The increase in the salmon price at the start of 2018, is also followed by an increase in the stock share prices to Salmar and Marine harvest.
 


